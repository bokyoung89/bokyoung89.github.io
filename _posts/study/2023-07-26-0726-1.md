---
published: true
title: "[JPA] @DataJpaTestì—ì„œ updateë¬¸ í™•ì¸ ë°©ë²•"
categories:
- JPA
tag:
- JPA
- springboot

---
> ğŸ‘©ğŸ»â€ğŸ’» @DataJpaTest ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•  ë•Œ updateë¬¸ì„ í™•ì¸í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.

@DataJpaTest ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ JpaRepositoyë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²½ìš°, update í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ selectë¬¸ë§Œ ì‹¤í–‰ë  ë¿ udpateì€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.

```java
    @DisplayName("update í…ŒìŠ¤íŠ¸")
    @Test
    void update_í…ŒìŠ¤íŠ¸() {

        //given
        Article article = articleRepository.findById(1L).orElseThrow();
        String updatedHashtag = "#Springboot";
        article.setHashtag(updatedHashtag);

        //when
        Article savedArticle = articleRepository.save(article);

        //then
        assertThat(savedArticle).hasFieldOrPropertyWithValue("hashtag", updatedHashtag);
    }
```

```java
Hibernate: 
    select
        a1_0.id,
        a1_0.content,
        a1_0.created_at,
        a1_0.created_by,
        a1_0.hashtag,
        a1_0.modified_at,
        a1_0.modified_by,
        a1_0.title 
    from
        article a1_0 
    where
        array_contains(?,a1_0.id)
```

ì´ìœ ëŠ” @DataJpaTestì— ê¸°ë³¸ì ìœ¼ë¡œ transactionalì´ ê±¸ë ¤ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì¦‰, @DataJpaTest ì–´ë…¸í…Œì´ì…˜ì„ ì„ ì–¸í•˜ë©´ ëª¨ë“  í…ŒìŠ¤íŠ¸ ë©”ì„œë“œë“¤ì€ ìë™ìœ¼ë¡œ transactionalì´ ë˜ê³ , transactionalì€ ê¸°ë³¸ìœ¼ë¡œ rollbackì´ ë™ì‘í•©ë‹ˆë‹¤.
ë”°ë¼ì„œ í…ŒìŠ¤íŠ¸ ì•ˆì—ì„œì˜ ë³€ê²½ì ì´ rollbackì— ì˜í•´ ìƒëµë  ìˆ˜ ìˆëŠ”ë°, ê·¸ì¤‘ í•˜ë‚˜ê°€ updateë¬¸ì…ë‹ˆë‹¤.
<br />
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¡œë¶€í„° ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ DBì— ë°˜ì˜í•˜ë ¤ë©´ save() ëŒ€ì‹  `saveAndFlush()`ë¥¼ ì‚¬ìš©í•´ flush ì²˜ë¦¬ë¥¼ í•˜ë©´ ë©ë‹ˆë‹¤. ì ìš©í•˜ë©´ ì•„ë˜ì²˜ëŸ¼ updateë¬¸ì´ ì‹¤í–‰ë˜ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
> flushë€? ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ DBì— ë°˜ì˜í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. Transaction commitì´ ì¼ì–´ë‚  ë•Œ flushê°€ ë™ì‘í•˜ëŠ”ë°, ì´ë•Œ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì— ìŒ“ì•„ ë†¨ë˜ INSERT, UPDATE, DELETE ì¿¼ë¦¬ê°€ DBì— ì „ì†¡ëœë‹¤.

ë‹¤ë§Œ transactionalì— ì˜í•´ rollbackë  ê²ƒì´ë¯€ë¡œ ì‹¤ì œë¡œ ë°˜ì˜ì€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```java
    @DisplayName("update í…ŒìŠ¤íŠ¸")
    @Test
    void update_í…ŒìŠ¤íŠ¸() {

        //given
        Article article = articleRepository.findById(1L).orElseThrow();
        String updatedHashtag = "#Springboot";
        article.setHashtag(updatedHashtag);

        //when
        Article savedArticle = articleRepository.saveAndFlush(article); //saveAndFlushë¡œ ë³€ê²½

        //then
        assertThat(savedArticle).hasFieldOrPropertyWithValue("hashtag", updatedHashtag);
    }
```

```java
Hibernate: 
    select
        a1_0.id,
        a1_0.content,
        a1_0.created_at,
        a1_0.created_by,
        a1_0.hashtag,
        a1_0.modified_at,
        a1_0.modified_by,
        a1_0.title 
    from
        article a1_0 
    where
        array_contains(?,a1_0.id)
Hibernate: 
    update
        article 
    set
        content=?,
        created_at=?,
        created_by=?,
        hashtag=?,
        modified_at=?,
        modified_by=?,
        title=? 
    where
        id=?
```



